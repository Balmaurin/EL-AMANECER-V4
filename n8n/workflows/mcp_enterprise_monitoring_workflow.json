{
  "name": "MCP Enterprise Monitoring & Coordination",
  "nodes": [
    {
      "parameters": {
        "rule": {
          "interval": [
            {
              "field": "minutes",
              "minutesInterval": 5
            }
          ]
        },
        "options": {}
      },
      "id": "a1b2c3d4-e5f6-g7h8-i9j0-k1l2m3n4o5p6",
      "name": "Schedule Trigger",
      "type": "n8n-nodes-base.scheduleTrigger",
      "typeVersion": 1,
      "position": [240, 300]
    },
    {
      "parameters": {
        "url": "http://prometheus:9090/api/v1/query",
        "sendBody": true,
        "bodyParameters": {
          "parameters": [
            {
              "name": "query",
              "value": "up{job=\"sheily-ai\"}"
            },
            {
              "name": "timeout",
              "value": "30s"
            }
          ]
        },
        "options": {}
      },
      "id": "b2c3d4e5-f6g7-h8i9-j0k1-l2m3n4o5p6q7",
      "name": "Collect Prometheus Metrics",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 1,
      "position": [460, 300]
    },
    {
      "parameters": {
        "url": "http://sheily-ai:8000/api/mcp/coordinator/monitoring/system-health",
        "sendBody": true,
        "bodyParameters": {
          "parameters": [
            {
              "name": "metrics_data",
              "value": "={{ $node['Collect Prometheus Metrics'].json }}"
            },
            {
              "name": "check_type",
              "value": "enterprise_health_check"
            }
          ]
        },
        "options": {}
      },
      "id": "c3d4e5f6-g7h8-i9j0-k1l2-m3n4o5p6q7r8",
      "name": "MCP Health Analysis",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 1,
      "position": [680, 300]
    },
    {
      "parameters": {
        "url": "http://sheily-ai:8000/api/security/elder-plinius/scan",
        "sendBody": true,
        "bodyParameters": {
          "parameters": [
            {
              "name": "scan_type",
              "value": "enterprise_security_audit"
            },
            {
              "name": "system_health_score",
              "value": "={{ $node['MCP Health Analysis'].json.health_score }}"
            }
          ]
        },
        "options": {}
      },
      "id": "d4e5f6g7-h8i9-j0k1-l2m3-n4o5p6q7r8s9",
      "name": "Elder Plinius Security Scan",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 1,
      "position": [900, 300]
    },
    {
      "parameters": {
        "values": {
          "boolean": [
            {
              "name": "health_below_threshold",
              "value": "={{ $node['MCP Health Analysis'].json.health_score < 95 }}"
            },
            {
              "name": "security_threat_detected",
              "value": "={{ $node['Elder Plinius Security Scan'].json.threat_level !== 'LOW' }}"
            }
          ]
        },
        "options": {}
      },
      "id": "e5f6g7h8-i9j0-k1l2-m3n4-o5p6q7r8s9t0",
      "name": "Alert Evaluation",
      "type": "n8n-nodes-base.set",
      "typeVersion": 1,
      "position": [1120, 300]
    },
    {
      "parameters": {
        "condition": "={{ $node['Alert Evaluation'].json.health_below_threshold || $node['Alert Evaluation'].json.security_threat_detected }}",
        "options": {}
      },
      "id": "f6g7h8i9-j0k1-l2m3-n4o5-p6q7r8s9t0u1",
      "name": "Emergency Check",
      "type": "n8n-nodes-base.if",
      "typeVersion": 1,
      "position": [1340, 300]
    },
    {
      "parameters": {
        "url": "http://sheily-ai:8000/api/mcp/coordinator/emergency-response",
        "sendBody": true,
        "bodyParameters": {
          "parameters": [
            {
              "name": "alert_type",
              "value": "enterprise_emergency"
            },
            {
              "name": "health_score",
              "value": "={{ $node['MCP Health Analysis'].json.health_score }}"
            },
            {
              "name": "security_level",
              "value": "={{ $node['Elder Plinius Security Scan'].json.threat_level }}"
            },
            {
              "name": "recommended_actions",
              "value": "={{ $node['MCP Health Analysis'].json.recommendations }}"
            }
          ]
        },
        "options": {}
      },
      "id": "g7h8i9j0-k1l2-m3n4-o5p6-q7r8s9t0u1v2",
      "name": "MCP Emergency Response",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 1,
      "position": [1340, 480]
    },
    {
      "parameters": {
        "url": "http://grafana:3000/api/dashboards/db",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Authorization",
              "value": "Bearer {{$env.GRAFANA_API_KEY}}"
            }
          ]
        },
        "sendBody": true,
        "bodyParameters": {
          "parameters": [
            {
              "name": "dashboard",
              "value": {
                "title": "Enterprise Health Dashboard - {{ new Date().toISOString() }}",
                "panels": [
                  {
                    "title": "System Health Score",
                    "type": "singlestat",
                    "targets": [
                      {
                        "expr": "{{ $node['MCP Health Analysis'].json.health_score }}"
                      }
                    ]
                  },
                  {
                    "title": "Security Threat Level",
                    "type": "singlestat",
                    "targets": [
                      {
                        "expr": "\"{{ $node['Elder Plinius Security Scan'].json.threat_level }}\""
                      }
                    ]
                  }
                ]
              }
            },
            {
              "name": "overwrite",
              "value": true
            }
          ]
        },
        "options": {}
      },
      "id": "h8i9j0k1-l2m3-n4o5-p6q7-r8s9t0u1v2w3",
      "name": "Update Grafana Dashboard",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 1,
      "position": [1560, 300]
    },
    {
      "parameters": {
        "serviceName": "Pushover",
        "message": "=ðŸš¨ **Enterprise Health Report**\nðŸ“Š Health Score: {{ $node['MCP Health Analysis'].json.health_score }}%\nðŸ›¡ï¸ Security Level: {{ $node['Elder Plinius Security Scan'].json.threat_level }}\nâš¡ Anomalies: {{ $node['MCP Health Analysis'].json.anomalies.length }}\nðŸ“± Last Check: {{ new Date().toLocaleString() }}",
        "title": "SHEILY Enterprise Health Monitor",
        "priority": 0,
        "options": {}
      },
      "id": "i9j0k1l2-m3n4-o5p6-q7r8-s9t0u1v2w3x4",
      "name": "Send Health Notification",
      "type": "n8n-nodes-base.pushover",
      "typeVersion": 1,
      "position": [1780, 300]
    },
    {
      "parameters": {
        "url": "http://sheily-ai:8000/api/analytics/enterprise-report",
        "sendBody": true,
        "bodyParameters": {
          "parameters": [
            {
              "name": "report_type",
              "value": "enterprise_health_monitoring"
            },
            {
              "name": "health_data",
              "value": "={{ $node['MCP Health Analysis'].json }}"
            },
            {
              "name": "security_data",
              "value": "={{ $node['Elder Plinius Security Scan'].json }}"
            },
            {
              "name": "timestamp",
              "value": "={{ new Date().toISOString() }}"
            }
          ]
        },
        "options": {}
      },
      "id": "j0k1l2m3-n4o5-p6q7-r8s9-t0u1v2w3x4y5",
      "name": "Generate Enterprise Report",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 1,
      "position": [2000, 300]
    }
  ],
  "connections": {
    "Schedule Trigger": {
      "main": [
        [
          {
            "node": "Collect Prometheus Metrics",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Collect Prometheus Metrics": {
      "main": [
        [
          {
            "node": "MCP Health Analysis",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "MCP Health Analysis": {
      "main": [
        [
          {
            "node": "Elder Plinius Security Scan",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Elder Plinius Security Scan": {
      "main": [
        [
          {
            "node": "Alert Evaluation",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Alert Evaluation": {
      "main": [
        [
          {
            "node": "Emergency Check",
            "type": "main",
            "index": 0
          },
          {
            "node": "Update Grafana Dashboard",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Emergency Check": {
      "main": [
        [],
        [
          {
            "node": "MCP Emergency Response",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "MCP Emergency Response": {
      "main": [
        [
          {
            "node": "Update Grafana Dashboard",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Update Grafana Dashboard": {
      "main": [
        [
          {
            "node": "Send Health Notification",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Send Health Notification": {
      "main": [
        [
          {
            "node": "Generate Enterprise Report",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "settings": {
    "timezone": "Europe/Madrid",
    "executionTimeout": 300,
    "saveExecutionProgress": true,
    "saveManualExecutions": false,
    "saveDataErrorExecution": "all",
    "saveDataSuccessExecution": "all"
  },
  "staticData": null,
  "meta": {
    "instanceId": "sheily_enterprise_monitoring"
  },
  "versionId": "1.0"
}
